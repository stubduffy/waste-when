name: Fetch new data

on:
  workflow_dispatch:

jobs:
  fetch-new-data:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Cypress run
        uses: cypress-io/github-action@v6
        with:
          browser: chrome
      - uses: actions/upload-artifact@v3
        if: ${{ failure() }}
        with:
          name: cypress-screenshots
          path: cypress/screenshots/
      - name: push to main
        uses: Automattic/action-commit-to-branch@master
        with:
          branch: main
          commit_message: 'Auto update calendar'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: update readme permalinks
        run: |
          echo "https://github.com/stubduffy/waste-when/blob/$(git rev-parse HEAD)/cal.json#L1-L6" > README.md
      - name: push to main
        uses: Automattic/action-commit-to-branch@master
        with:
          branch: main
          commit_message: 'Auto update readme'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
 